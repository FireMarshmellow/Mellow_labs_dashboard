{% extends "base.html" %}
{% block content %}
<h1 class="text-xl font-semibold mb-4">Expenses</h1>
<div class="space-y-6">
  <form method="post" action="/expenses" class="p-4 rounded-2xl bg-slate-800 max-w-2xl">
    <div class="grid gap-4">
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      <div>
        <label class="text-xs text-slate-300">Date</label>
        <input type="date" name="date" required class="w-full bg-slate-900 rounded px-2.5 py-1.5 text-sm"/>
      </div>
      <div>
        <label class="text-xs text-slate-300">Category</label>
        <div class="flex gap-2">
          <select name="category_id" class="flex-1 bg-slate-900 rounded px-2.5 py-1.5 text-sm">
            <option value="">—</option>
            {% for c in categories %}<option value="{{c.id}}">{{ c.name }}</option>{% endfor %}
          </select>
          <button formaction="/expenses/category" formmethod="post" class="px-2 py-1 rounded bg-slate-700" onclick="return addCategory(event)">Add</button>
        </div>
      </div>
      <div>
        <label class="text-xs text-slate-300">Seller</label>
        <input name="seller" required class="w-full bg-slate-900 rounded px-2.5 py-1.5 text-sm"/>
      </div>
      <div>
        <label class="text-xs text-slate-300">Order #</label>
        <input name="order_number" class="w-full bg-slate-900 rounded px-2.5 py-1.5 text-sm"/>
      </div>
      <div>
        <label class="text-xs text-slate-300">Total Amount (£)</label>
        <input type="number" step="0.01" min="0" name="total_amount_gbp" required class="w-full bg-slate-900 rounded px-2.5 py-1.5 text-sm"/>
      </div>
      <div class="col-span-full">
        <label class="text-xs text-slate-300">Notes</label>
        <textarea name="notes" class="w-full bg-slate-900 rounded px-2.5 py-1.5 text-sm" rows="2"></textarea>
      </div>
      <div class="col-span-full sm:col-span-1">
        <button class="w-full py-1.5 rounded bg-blue-600 hover:bg-blue-500 text-sm">Add Expense</button>
      </div>
    </div>
    </div>
  </form>

  <div class="p-4 rounded-2xl bg-slate-800">
    <div class="flex justify-end mb-2">
      <a href="/expenses/export" class="text-xs px-3 py-1 rounded bg-slate-700 hover:bg-slate-600">Export CSV</a>
    </div>
    <table class="w-full text-sm">
      <thead>
        <tr class="text-left text-slate-400">
          <th class="py-2">Date</th>
          <th>Category</th>
          <th>Seller</th>
          <th>Order #</th>
          <th class="text-right">Total</th>
          <th>Notes</th>
        </tr>
      </thead>
      <tbody>
        {% for e in expenses %}
        <tr class="border-t border-slate-700">
          <td class="py-2">{{ e.date }}</td>
          <td>{{ e.category.name if e.category }}</td>
          <td>{{ e.seller }}</td>
          <td>{{ e.order_number or '' }}</td>
          <td class="text-right">£{{ '%.2f'|format(e.total_amount_gbp) }}</td>
          <td class="truncate max-w-[26ch]">{{ e.notes or '' }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
<script>
  function addCategory(e){
    e.preventDefault();
    const name = prompt('Add new expense category');
    if(!name) return false;
    const f = document.createElement('form'); f.method='post'; f.action='/expenses/category';
    const inp = document.createElement('input'); inp.name='name'; inp.value=name; f.appendChild(inp);
    document.body.appendChild(f); f.submit();
    return false;
  }
</script>
{% endblock %}
